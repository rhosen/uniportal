@page
@model UniPortal.Pages.Dashboards.StudentModel
@{
    ViewData["Title"] = "Student Dashboard";
    Layout = "_StudentLayout";
    string initials = string.Join("", Model.Profile.FullName
                                       .Split(' ', StringSplitOptions.RemoveEmptyEntries)
                                       .Select(n => n[0]))
                        .ToUpper();
}

<link href="~/css/metric-card.css" rel="stylesheet" />
<link href="~/css/sidebar.css" rel="stylesheet" />

<div class="container my-4">
    <div class="row g-4">
        <div class="col-lg-3">
            <div class="premium-sidebar p-4 rounded-4 shadow-sm sticky-top bg-white" style="top: 20px; height: calc(100%vh - 40px); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08); animation: fadeIn 1s ease-in-out;">

                <!-- Profile Initials -->
                <div class="d-flex justify-content-center mb-3">
                    <div class="rounded-circle bg-primary text-white d-flex justify-content-center align-items-center shadow profile-avatar"
                         style="width:80px; height:80px; font-size:28px; font-weight:700;">
                        @initials
                    </div>
                </div>

                <h5 class="text-center fw-semibold mb-3" style="font-size: 1.25rem;">@Model.Profile.FullName</h5>

                <div class="text-center mb-3 text-muted" style="font-size: 0.875rem;">
                    <small>Student ID: @Model.Profile.StudentId</small>
                </div>

                <div class="mb-3">
                    <hr class="divider" />
                </div>

                <div class="mb-4">
                    <div class="text-center mb-2">
                        <span class="d-inline-block px-3 py-1 bg-light text-dark fw-medium border shadow-sm small badge-hover" style="font-size: 0.875rem;">
                            @Model.Profile.Department
                        </span>
                    </div>

                    <div class="text-center mb-2">
                        <span class="d-inline-block px-3 py-1 bg-light text-dark fw-medium border shadow-sm small badge-hover" style="font-size: 0.875rem;">
                            Batch: @Model.Profile.Batch
                        </span>
                    </div>

                    <div class="text-center mb-2">
                        <span class="d-inline-block px-3 py-1 bg-light text-dark fw-medium border shadow-sm small badge-hover" style="font-size: 0.875rem;">
                            Section: @Model.Profile.Section
                        </span>
                    </div>
                </div>

                <div class="mb-3">
                    <hr class="divider" />
                </div>

                <div class="text-center mb-4 text-muted" style="font-size: 0.875rem;">
                    <div class="mb-1">
                        <span class="d-inline-block px-3 py-1 bg-light text-dark fw-medium border shadow-sm small badge-hover" style="font-size: 0.875rem;">
                            @Model.Profile.Email
                        </span>
                    </div>

                    <div>
                        <span class="d-inline-block px-3 py-1 bg-light text-dark fw-medium border shadow-sm small badge-hover" style="font-size: 0.875rem;">
                            @Model.Profile.Phone
                        </span>
                    </div>
                </div>

                <div class="mb-3">
                    <hr class="divider" />
                </div>

                <div class="d-grid">
                    <a asp-page="/accounts/password" class="btn btn-outline-primary fw-semibold btn-hover" style="font-size: 0.875rem;">
                        Change Password
                    </a>
                </div>
            </div>
        </div>


        <!-- Right Column: Metric Cards -->
        <div class="col-lg-9">
            <div class="row g-3">
                <!-- Courses -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/courses")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <path d="M10 40V10l22 10 22-10v30L32 32 10 40z" fill="#6f42c1" />
                            </svg>
                            <div class="card-title">Courses</div>
                            <div class="card-value">@Model.Metrics.Courses</div>
                        </div>
                    </div>
                </div>

                <!-- Assignments -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/assignments")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <rect x="12" y="12" width="40" height="30" rx="4" ry="4" fill="#28a745" />
                                <line x1="12" y1="22" x2="52" y2="22" stroke="#fff" stroke-width="2" />
                            </svg>
                            <div class="card-title">Assignments</div>
                            <div class="card-value">@Model.Metrics.PendingAssignments</div>
                        </div>
                    </div>
                </div>

                <!-- Today’s Classes -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/schedule")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <rect x="12" y="12" width="40" height="30" rx="4" ry="4" fill="#fd7e14" />
                            </svg>
                            <div class="card-title">Schedule</div>
                            <div class="card-value">@Model.Metrics.TodayClasses</div>
                        </div>
                    </div>
                </div>

                <!-- Attendance -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/attendance")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <circle cx="32" cy="24" r="10" fill="#17a2b8" />
                            </svg>
                            <div class="card-title">Attendance</div>
                            <div class="card-value">@Model.Metrics.AttendancePercent%</div>
                        </div>
                    </div>
                </div>

                <!-- Grades -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/grades")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <polygon points="32,4 60,44 4,44" fill="#ffc107" />
                            </svg>
                            <div class="card-title">Grades</div>
                            <div class="card-value">@Model.Metrics.OverallGPA</div>
                        </div>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/notifications")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <path d="M32 4c-8 0-14 6-14 14v8l-6 6v2h40v-2l-6-6v-8c0-8-6-14-14-14z" fill="#dc3545" />
                            </svg>
                            <div class="card-title">Notifications</div>
                            <div class="card-value">@Model.Metrics.UnreadNotifications</div>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/student/notes")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <rect x="10" y="8" width="44" height="32" rx="4" ry="4" fill="#6c757d" />
                            </svg>
                            <div class="card-title">Notes</div>
                            <div class="card-value">@Model.Metrics.NotesCount</div>
                        </div>
                    </div>
                </div>

                <!-- Classrooms -->
                <div class="col-md-3 col-sm-6">
                    <div class="metric-card" onclick="location.href='@Url.Page("/classes/room")'">
                        <div class="metric-content">
                            <svg class="metric-icon" viewBox="0 0 64 48">
                                <path d="M32 4L4 16l28 12 28-12L32 4z" fill="#007bff" />
                            </svg>
                            <div class="card-title">Classrooms</div>
                            <div class="card-value">@Model.Metrics.Classrooms</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assignments Table -->
            <div class="card shadow-sm rounded-4 mt-4 p-3">
                <h5 class="fw-bold mb-3"><i class="bi bi-journal-text me-2"></i>My Assignments</h5>
                @if (Model.Assignments.Any())
                {
                    <form method="post" enctype="multipart/form-data" asp-page-handler="SubmitAssignment">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Course</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Submit</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var a in Model.Assignments)
                                {
                                    <tr>
                                        <td>@a.Title</td>
                                        <td>@a.CourseName</td>
                                        <td>@a.DueDate.ToString("dd MMM yyyy")</td>
                                        <td>@a.Status</td>
                                        <td>
                                            <input type="file" name="file_@a.Id" class="form-control form-control-sm" />
                                            <button type="submit" name="assignmentId" value="@a.Id" class="btn btn-sm btn-success mt-1">Upload</button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </form>
                }
                else
                {
                    <p class="text-muted">No upcoming assignments 🎉</p>
                }
                <a asp-page="/Student/Assignments" class="btn btn-sm btn-outline-secondary mt-2">View All</a>
            </div>
        </div>
    </div>
</div>
